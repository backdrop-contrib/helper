<?php

include __DIR__ . '/../lib/ArrayHelper.php';
include __DIR__ . '/../lib/XmlHelper.php';

class XmlHelperTestCase extends DrupalUnitTestCase {

  public static function getInfo() {
    return array(
      'name' => 'XmlHelper',
      'description' => 'Tests for the XmlHelper class.',
      'group' => 'Helper',
    );
  }

  public function testXmlParsing() {
    $data = <<<END
<root xmlns:Test="test">
<element1>element1value</element1>
<element2><![CDATA[ <p><em>element2value</em></p> ]]></element2>
<element2 type="edge-case">
  <sub1 key="value" Test:key="7"> sub1value </sub1>
  <sub2><![CDATA[ ]]></sub2>
  <sub3>
  </sub3>
  <sub4 />
</element2>
<element3>
  <sub1>sub1value</sub1>
  <sub2>sub2value</sub2>
  <sub3><![CDATA[sub3value]]></sub3>
</element3>
</root>
END;
    $result = XmlHelper::parseElements($data);
    $this->assertIdentical($result, array(
      'element1' => 'element1value',
      1 => array(
        'name' => 'element2',
        'value' => '<p><em>element2value</em></p>',
      ),
      2 => array(
        'name' => 'element2',
        'attributes' => array('type' => 'edge-case'),
        'value' => array(
          'sub1' => array(
            'attributes' => array('key' => 'value', 'Test:key' => '7'),
            'value' => 'sub1value',
          ),
          'sub2' => '',
          'sub3' => '',
          'sub4' => '',
        ),
      ),
      'element3' => array(
        'value' => array(
          'sub1' => 'sub1value',
          'sub2' => 'sub2value',
          'sub3' => 'sub3value',
        ),
      ),
    ));

    $result = XmlHelper::parseElements($data, FALSE);
    $this->assertIdentical($result, array(
      0 => array(
        'name' => 'element1',
        'value' => 'element1value',
      ),
      1 => array(
        'name' => 'element2',
        'value' => '<p><em>element2value</em></p>',
      ),
      2 => array(
        'name' => 'element2',
        'attributes' => array('type' => 'edge-case'),
        'value' => array(
          0 => array(
            'name' => 'sub1',
            'attributes' => array('key' => 'value', 'Test:key' => '7'),
            'value' => 'sub1value',
          ),
          1 => array(
            'name' => 'sub2',
            'value' => '',
          ),
          2 => array(
            'name' => 'sub3',
            'value' => '',
          ),
          3 => array(
            'name' => 'sub4',
            'value' => '',
          ),
        ),
      ),
      3 => array(
        'name' => 'element3',
        'value' => array(
          0 => array(
            'name' => 'sub1',
            'value' => 'sub1value',
          ),
          1 => array(
            'name' => 'sub2',
            'value' => 'sub2value',
          ),
          2 => array(
            'name' => 'sub3',
            'value' => 'sub3value',
          ),
        ),
      ),
    ));

  }


}
